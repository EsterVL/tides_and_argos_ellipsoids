#This script will import the different tables that are used for this project in the location Oman
#The tables will also be edited, so it will be easier to work with them.

#The input of this script
tides_table <- read.csv("oman_tides_2016_2020.txt", sep="")
birdlocation_table <- read.csv("BarWitsOman_Winter2016.csv")
metadata_images_table <- read.csv("datetime_table.txt", sep="")
metadata_tiff_table <- list.files(pattern='local_tidal_level_*', full.names=TRUE)

#Making sure all tables have a 'timestamp' collumn that includes the date and time.
#This will make it easier to give these collumns a timestamp.
tides_table$timestamp <- paste(tides_table$mm.dd.yyyy, tides_table$hh.mm.ss, sep = ' ')
tides_table <- tides_table[, c("Lat","Lon", "timestamp", "z.m.", "Depth.m.")]
tides_table <- tides_table[order(tides_table$timestamp),]

#Give all the tables a timestamp This is specific to the minute.
tides_table$timestamp <- strptime(tides_table$time, format='%m.%d.%Y %H:%M', tz = 'UTC')
birdlocation_table$timestamp <- strptime(birdlocation_table$timestamp, format='%Y-%m-%d %H:%M', tz = 'UTC')
metadata_images_table$timestamp <- strptime(metadata_images_table$timestamp, format='%Y-%m-%d-%H-%M', tz = 'UTC')

#make sure the 'location-bird' table has a location-stamp too.
positievogel <- SpatialPointsDataFrame(data.frame(birdlocation_table$location.long, birdlocation_table$location.lat), data.frame(birdlocation_table))
proj4string(positievogel)=CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs")

#Fist the next tidal point is calculated and added in a new collumn for every row in the tides table
#then we add the z.m. and the next tide point from the tides_table to the metadata image table and the birdlocation_table
tides_table$tide_next_point<-shift(tides_table$z.m., n=1, fill=NA, type="lead")
ss_tides_table <-  tides_table[, c("timestamp", "tide_next_point", "z.m.")]
metadata_images_table <- merge(x=metadata_images_table, y=ss_tides_table, by="timestamp", all.x=T, sort=F)
birdlocation_table <- merge(x=birdlocation_table, y=tides_table, by="timestamp", all.x=T, sort=F)

#the output of this script
#tides_table with timestamp and tide next point
#birdlocation_table with timestamp, locationstamp, tide next point and z.m.
#metadata_image_table with timestamp, tide next point and z.m.
#metadata_tiff_table with filenames and respective image numbers




